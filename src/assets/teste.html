<!DOCTYPE html>
<html lang="pt-br" ng-app="pedidos">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <base target="_top">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- Libs -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
        </script>
    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js"
        integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.js"
        integrity="sha512-rCVQBDU9Ny0aKLo1/B1MqgRjWEMlCL3WJ0DD6mJeK6qMZqpN9JCRxPtMQWWR9XWCMFIqlSgT4uOdwpvxWTSejw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.js"
        integrity="sha512-MNW6IbpNuZZ2VH9ngFhzh6cUt8L/0rSVa60F8L22K1H72ro4Ki3M/816eSDLnhICu7vwH/+/yb8oB3BtBLhMsA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <!-- Backend -->
    <script>
        angular.module('pedidos', []);
        angular.module('pedidos', []).controller('pedidosCtrl', async function ($scope, $http) {

            console.log("TESTEEEEEEEEEEEEEEEEEEEEE")

            $scope.arrPedidos = []
            // // $scope.serverUrl = 'http://localhost:14000/API/pedido'


            // chama API para atualizar a lista
            const atualisaLista = async () => {
                i
                const res = await axios({
                    method: 'get',
                    url: `http://localhost:14000/API/pedido`,
                    headers: {
                        auth: '4a5bcf5ad29790746397ed3f25d8e8956da8e4ce'
                    }
                }).catch(err => console.log("erro da requisiÃ§Ã£o -> ", err));

                if (res.data) {

                    res.data.forEach(element => {
                        $scope.arrPedidos.push(element)
                    });
                    $scope.$apply()
                }

                console.log("objeto $scope.arrPedidos-> ", $scope.arrPedidos)
                setTimeout(atualisaLista, 7000);
            }

            await atualisaLista();
        })
    </script>
</head>

<!-- Frontend -->

<body ng-controller='pedidosCtrl'>
    <!-- https://getbootstrap.com/docs/4.3/components/card/ -->

    <div id="app">
        <div ng-controller="pedidosCtrl as ctrl">

            <h8 class="card-subtitle mb-1 text-muted">teste</h8>

            <div ng-repeat="pedido in ctrl.arrPedidos" class="card border-dark mb-3 text-center">
                <h5 class="card-header">{{pedido.cliente_nome}}</h5>
                <div class="card-body">
                    <p class="card-text">{{pedido.descricao}}</p>
                    <h6 class="card-subtitle mb-2 text-muted">ðŸ“Œ pedido.endereco</h6>
                    <h6 class="card-subtitle mb-2 text-muted">ðŸ’³ pedido.formaPagamento</h6>
                    <h6 class="card-subtitle mb-2 text-muted">ðŸ’° Valor <cite
                            title="Source Title">R${{pedido.valor}}</cite></h6>
                    <!-- <button ng-click="testBtn(pedido._id)" type="button" class="btn btn-success">Aceitar</button> -->
                    <!-- <button ng-click="testBtn()" type="button" class="btn btn-success">Aceitar</button>
                    <button ng-click="testBtn()" type="button" class="btn btn-danger">Recusar</button> -->
                    <br />
                    <h8 class="card-subtitle mb-1 text-muted">Criado em {{pedido.dataCriacao}}</h8>
                </div>
            </div>
        </div>
    </div>
</body>

</html>